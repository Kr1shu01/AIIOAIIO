<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½å¡æœº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1000;
        }
        
        h1 {
            text-align: center;
            font-size: 5rem;
            color: #4deeea;
            text-shadow: 0 0 20px rgba(77, 238, 234, 0.6);
            font-weight: 800;
            letter-spacing: 2px;
            margin: 0;
            flex: 1;
        }
        
        .main-container {
            display: flex;
            max-width: 1400px;
            width: 100%;
            gap: 20px;
            margin-top: 25px;
        }
        
        .left-panel {
            flex: 7; /* 70%å®½åº¦ */
            background: rgba(10, 15, 30, 0.9);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .right-panel {
            flex: 3; /* 30%å®½åº¦ */
            background: rgba(10, 15, 30, 0.9);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(100, 150, 255, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .ranking-table {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            height: 100%;
        }
        
        .rank-label {
            font-weight: bold;
            font-size: 2.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: #333333 !important;
            min-width: 100px; /* å¢åŠ æ ‡ç­¾å®½åº¦ */
        }
        
        .rank-1 { background: linear-gradient(135deg, #ff4444, #cc0000); }
        .rank-2 { background: linear-gradient(135deg, #ff8800, #cc6600); }
        .rank-3 { background: linear-gradient(135deg, #ffbb33, #ffaa00); }
        .rank-4 { background: linear-gradient(135deg, #ffff66, #ffdd00); }
        .rank-5 { background: linear-gradient(135deg, #ffffff, #dddddd); }
        
        .drop-zone {
            background: rgba(255, 255, 255, 0.1);
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            min-height: 100px;
            position: relative;
            transition: all 0.3s ease;
            padding: 10px;
        }
        
        .drop-zone.drag-over {
            background: rgba(77, 238, 234, 0.2);
            border-color: #4deeea;
        }
        
        .placed-images {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 80px;
        }
        
        .dropped-image {
            max-width: 80px;
            max-height: 80px;
            border-radius: 8px;
            object-fit: cover;
            cursor: move;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.2s;
        }
        
        .dropped-image:hover {
            transform: scale(1.05);
        }
        
        .content-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }

        #image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .fade-container {
            position: relative;
            width: 250px; /* ç¨å¾®å‡å°å›¾ç‰‡å°ºå¯¸ä»¥é€‚åº”æ›´çª„çš„å³ä¾§é¢æ¿ */
            height: 250px;
            margin-bottom: 30px;
        }

        .fade-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .fade-img.active {
            opacity: 1;
        }

        #pal-name {
            font-size: 2.8rem; /* ç¨å¾®å‡å°å­—ä½“ä»¥é€‚åº”ç©ºé—´ */
            color: #4deeea;
            text-shadow: 0 0 15px rgba(77, 238, 234, 0.7);
            margin-bottom: 25px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn {
            padding: 15px 30px;
            font-size: 2.4rem;
            font-weight: 600;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            width: 220px; /* å‡å°æŒ‰é’®å®½åº¦ä»¥é€‚åº”å³ä¾§é¢æ¿ */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            transition: all 0.3s ease;
            outline: none;
            background: linear-gradient(135deg, #2196F3, #0d47a1);
            color: white;
            margin-bottom: 15px;
        }

        .btn:hover:not(.btn-disabled):not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.7);
        }

        .btn:active:not(.btn-disabled):not(:disabled) {
            transform: translateY(1px);
        }

        .btn-disabled {
            background: linear-gradient(135deg, #9e9e9e, #616161);
            color: #bdbdbd;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* æŠ½å–åŠ¨ç”» */
        @keyframes drawAnimation {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(2deg); }
            50% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.05) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .draw-result {
            animation: drawAnimation 0.6s ease-out;
        }

        /* è¿›åº¦æ˜¾ç¤º */
        .progress-info {
            margin-top: 20px;
            font-size: 1.1rem; /* ç¨å¾®å‡å°å­—ä½“ */
            color: #7fdbff;
            text-align: center;
        }
        
        /* æ‹–æ‹½ç›¸å…³æ ·å¼ */
        [draggable] {
            cursor: grab;
        }
        
        [draggable]:active {
            cursor: grabbing;
        }
        
        .dragging {
            opacity: 0.5;
        }
        
        /* æ¸…é™¤æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .clear-temp-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ä»å¤¯ğŸ˜¼åˆ°æ‹‰ğŸ˜¹   å¸•é²æ‰­è›‹æœº</h1>
</div>

<div class="main-container">
    <!-- å·¦ä¾§æ’åé¢æ¿ (70%å®½åº¦) -->
    <div class="left-panel">
        <div class="ranking-table">
            <div class="rank-label rank-1">å¤¯</div>
            <div class="drop-zone" data-rank="1" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
                <div class="placed-images"></div>
            </div>
            
            <div class="rank-label rank-2">é¡¶çº§</div>
            <div class="drop-zone" data-rank="2" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
                <div class="placed-images"></div>
            </div>
            
            <div class="rank-label rank-3">äººä¸Šäºº</div>
            <div class="drop-zone" data-rank="3" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
                <div class="placed-images"></div>
            </div>
            
            <div class="rank-label rank-4">NPC</div>
            <div class="drop-zone" data-rank="4" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
                <div class="placed-images"></div>
            </div>
            
            <div class="rank-label rank-5">æ‹‰å®Œäº†</div>
            <div class="drop-zone" data-rank="5" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
                <div class="placed-images"></div>
            </div>
        </div>
    </div>
    
    <!-- å³ä¾§æŠ½å¡é¢æ¿ (30%å®½åº¦) -->
    <div class="right-panel">
        <div class="content-center">
            <div id="image-container">
                <div class="fade-container">
                    <img id="pal-image-1" class="fade-img" src="" alt="å¸•é²å›¾åƒ">
                    <img id="pal-image-2" class="fade-img" src="" alt="å¸•é²å›¾åƒ">
                </div>
                <h2 id="pal-name">å¼€å§‹æŠ½å–</h2>
                <div id="progress-info" class="progress-info">å·²æŠ½å–: 0/225 (0%)</div>
            </div>
            <button id="draw-button" class="btn" onclick="toggleDraw()">å¼€å§‹æŠ½å–</button>
            <button class="btn clear-temp-btn" onclick="clearTemporary()">æ¸…ç†æš‚å­˜</button>
        </div>
    </div>
</div>

<script>
  const pals = [
    "æ£‰æ‚ æ‚ ", "æ£è›‹çŒ«", "çš®çš®é¸¡", "ç¿ å¶é¼ ", "ç«ç»’ç‹", "é›ªç»’ç‹", 
    "å†²æµªé¸­", "çƒ­æµªé¸­", "ä¼ç‰¹å–µ", "æ–°å¶çŒ¿", "ç‡ç«é¹¿", "ä¼ä¸¸ä¸¸", "é—ªä¸¸ä¸¸",
    "ä¼ä¸¸ç‹", "é—ªä¸¸ç‹", "ç”µæ£˜é¼ ", "å†°åˆºé¼ ", "å¶æ³¥æ³¥", "ç‰è—»ç‹", "å•¼å¡å°”",
    "å£¶å°è±¡", "ç…ä»€é­”", "ç±³éœ²è²", "å¯é­”", "è‰è½çŒª", "éœ²å¨œè’‚", "éåœ°é¼ ",
    "å‹¾é­‚é±¿", "èš€é­‚é±¿", "å–µæ–¯ç‰¹", "å†°æ–¯ç‰¹", "é²ç±³å„¿", "é›·ç±³å„¿", "çŒç‹¼",
    "ç‚¸è›‹é¸Ÿ", "æ³¢å¨œå…”", "æ³¢éœ¸ç‰›", "è†æ£˜é­”ä»™", "é²¨å°å­", "çº¢å°é²¨", "åŠç¼šçµ",
    "å†°ç¼šçµ", "å¶èƒ–è¾¾", "é›·èƒ–è¾¾", "æ£‰èŠ±ç³–", "çŒæœ¨ç¾Š", "éƒæœ¨ç¾Š", "ç¾éœ²å¸•",
    "ç´«éœé¹¿", "ç¥‡å²³é¹¿", "ç–¾é£éš¼", "å§¬å°å…”", "è‰¾å°å…”", "ç‚é­”ç¾Š", "æš—é­”ç¾Š",
    "å¹»æ‚¦è¶", "ç‚½ç„°ç‰›", "è¶´è¶´é²¶", "æ¢†æ¢†é²¶", "é»‘é¸¦éšå£«", "æœ‹å…‹èœ¥", "çƒ­è¡€èœ¥",
    "æ··æ²Œéª‘å£«", "å”¤å†¬å…½", "å”¤å¤œå…½", "ç©ºæ¶¡é¾™", "è´èˆè¯ºå¨ƒ", "è´èˆéœ²æ´", "è¾‰æœˆä¼Š",
    "æ­¦é“è›™", "æé“è›™", "æ˜¥å½©å¨˜", "è‡å’š", "è‡æ³¢", "çƒçŠ°", "æç‚¬çµ", "è›Šåˆºå¦–",
    "æ³°é”‹", "å…«äº‘çŠ¬", "æ±ªå®—å¸ˆ", "æˆ˜å† é›€", "æ—ºè´¢", "æ°è¯ºè´è¾¾", "æ°è¯ºè·¯è¾¾",
    "æ°è¯ºå¤šå…°", "é­…çˆ±è‰", "å¤œå†¥é©¹", "è‰¾åŸºé²è¿¦", "å¢¨ä¸¸", "å‡€ä¸–é¹¿", "é¢æƒ§",
    "å¹½æ‹å¨œ", "æ¡ƒè››å¨˜", "é©­é›·é©¬", "éœœç‰™ç‹", "æ¢…è‰å§†", "å¦®ç…è", "é‡‘é©°å…½",
    "è¾¾é¼ æ³¥", "å†°å§¬çµ", "ç™½çœŸé›ªé›€", "å’•å’•æ¡‘è‘©", "æ¢å¶é¾™", "è‚šè‚šé³„", "é¦™è‰è±¹å†°",
    "ç›”ç›”ä»”", "é‡‘ç›”ä»”", "æµ·æœˆçµ", "æµ·æœˆä»™", "å¢¨æ²«å§¬", "å¸ƒå¶é²¨", "ç²‰ç²‰å¸ƒå¶é²¨",
    "å†¥ç¯é±¼", "ç‚™ç¯é±¼", "å‡‰æ™¶é²¸", "æ¡ƒæ™¶é²¸", "æµ·çš‡é²¸",
    // å²è±å§†ç³»åˆ—
    "ç»¿å²è±å§†", "è“å²è±å§†", "çº¢å²è±å§†", "ç´«å²è±å§†", "å¤œæ˜å²è±å§†", "å½©è™¹å²è±å§†",
    "é™„é­”å‰‘", "æ´ç©´è™è ", "å¤œæ˜è™è ", "å…‹è‹é²ä¹‹çœ¼", "æ¶é­”çœ¼",

    "æœˆé•°é­”", "éœœé•°é­”", "å¤©æ“’é¸Ÿ", "ç¾½ç®­å°„æ‰‹", "å±±å²³å°„æ‰‹", "é“æ‹³çŒ¿", "çŸ³æŒçŒ¿",
    "éª‘å£«èœ‚", "å¥³çš‡èœ‚", "ç¬‘é­‡çŒ«", "æ¯›æ¸å„¿", "æ¯›è€çˆ¹", "ç–¾æ—‹é¼¬", "æ¡ƒæ—‹é¼¬",
    "é›·è§’é©¬", "å¹é›ªç‹", "ç«éº’éºŸ", "é‚ªéº’éºŸ", "ä¸¥å†¬é¹¿", "éœ¹é›³çŠ¬", "è‹ç„°ç‹¼",
    "å¹½ç„°ç‹¼", "é›·é¸£ç«¥å­", "å¤©é˜´ç«¥å­", "ç§˜æ–¯åªé›…", "èŠ±å† é¾™", "é›·å† é¾™",
    "æ»‘æ°´è›‡", "æµæ²™è›‡", "å™¬é­‚å…½", "ç¢å²©é¾Ÿ", "çŒ«è æ€ª", "åšçˆ±èœ¥", "èç„°å¨˜",
    "çƒ½æ­Œé¾™", "éœœæ­Œé¾™", "æµªåˆƒæ­¦å£«", "é¬¼åˆƒæ­¦å£«", "è¿…é›·é¸Ÿ", "ç‡§ç«é¸Ÿ", "æš—å·«çŒ«",
    "ç‚½å·«çŒ«", "ç„°å·«ç‹", "å¹½å·«ç‹", "è¸æ˜¥å…”", "è–‡è‰å¡”", "ç»¸ç¬ è›¾", "ç²¾çµé¾™",
    "æ°´çµé¾™", "æ°´çµå„¿", "ç«çµå„¿", "ç¢§æµ·é¾™", "ç¢§æœˆé¾™", "å†°æ£˜å…½", "é‡‘æ£˜å…½", "ç‹±ç„°ç‹", "ç‹±é˜ç‹",
    "ä½©å…‹é¾™", "æ´¾å…‹é¾™", "è¿ç†é¾™", "æµ·èª“é¾™", "èŠ±ä¸½å¨œ", "ç†”å²©å…½", "å¯’éœœå…½",
    "å›ç‹ç¾éœ²å¸•", "å†°å¸ç¾éœ²å¸•", "æ£®çŒ›çŠ¸", "é›ªçŒ›çŠ¸", "ç™½ç»’é›ªæ€ª", "ç»¿è‹”ç»’æ€ª",
    "é“ æ ¼åŠ›æ–¯", "æ ¼é²åŠ›æ–¯", "äº‘æµ·é¹¿", "é›·éšé¹¿", "å¤œå¹•é­”è ", "å¤©ç¾½é¾™", "ç¿ ç¾½é¾™",
    "ç„°ç…Œ", "æ®æ®ƒ", "é›·å†¥é¸Ÿ", "é›·é¸£é¸Ÿ", "é­”æ¸Šé¾™", "å†¥é“ è", "é‡‘é“ è",
    "é˜¿åŠªæ¯”æ–¯", "è¦†æµ·é¾™", "è…¾ç‚é¾™", "æœ±é›€", "æ¸…é›€", "æš´ç”µç†Š", "ç™¾åˆå¥³ç‹",
    "é»‘æœˆå¥³ç‹", "è·é²æ–¯", "ä¼Šè¥¿æ–¯", "æ³¢é²æ°å…‹æ–¯", "å¼‚æ„æ ¼é‡ŒèŠ¬", "åœ£å…‰éª‘å£«"
  ];

  let fullList = [...pals]; // å®Œæ•´åˆ—è¡¨
  let availableList = [...pals]; // å¯æŠ½å–åˆ—è¡¨ï¼ˆå»é™¤å·²æŠ½å–çš„ï¼‰
  let currentIndex = 0;
  let intervalId;
  let drawing = false;
  let imgIndex = 0; // ç”¨äºåŒç¼“å†²åˆ‡æ¢å›¾ç‰‡
  let totalPals = pals.length;
  let draggedElement = null;
  let currentPalName = ""; // å½“å‰æ˜¾ç¤ºçš„å¸•é²åç§°
  let placedCount = 0; // å·¦ä¾§å®é™…æ”¾ç½®çš„å›¾ç‰‡æ•°é‡
  let drawnCount = 0; // å³ä¾§å·²æŠ½å–çš„å¸•é²æ•°é‡ï¼ˆä¸é‡ç½®ï¼‰
  let drawnHistory = new Set(); // å·²æŠ½å–çš„å†å²è®°å½•
  
  function getImageUrl(name) {
    // ç›´æ¥ä½¿ç”¨ä¸­æ–‡åä½œä¸ºæ–‡ä»¶å
    return `images/${encodeURIComponent(name)}.png`;
  }

  function preloadImage(src) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve();
      img.onerror = () => {
        console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${src}ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡`);
        resolve(); // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­ï¼Œé¿å…é˜»å¡
      };
      img.src = src;
    });
  }

  function switchImage(index) {
    const name = availableList[index];
    const imageUrl = getImageUrl(name);
    
    // åˆ‡æ¢å›¾ç‰‡ç´¢å¼•
    const currentImg = document.getElementById(`pal-image-${imgIndex + 1}`);
    const nextImgIndex = 1 - imgIndex;
    const nextImg = document.getElementById(`pal-image-${nextImgIndex + 1}`);
    
    // é¢„åŠ è½½å›¾ç‰‡
    preloadImage(imageUrl).then(() => {
      // è®¾ç½®ä¸‹ä¸€å¼ å›¾ç‰‡
      nextImg.src = imageUrl;
      
      // æ·¡å‡ºå½“å‰å›¾ç‰‡ï¼Œæ·¡å…¥ä¸‹ä¸€å¼ 
      currentImg.classList.remove('active');
      setTimeout(() => {
        nextImg.classList.add('active');
        imgIndex = nextImgIndex;
      }, 10);
    });
    
    document.getElementById("pal-name").textContent = name;
    currentPalName = name; // ä¿å­˜å½“å‰å¸•é²åç§°
  }

  function updateProgress() {
    // æ˜¾ç¤ºå·²æŠ½å–çš„æ•°é‡å’Œç™¾åˆ†æ¯”
    const progressText = `å·²æŠ½å–: ${drawnCount}/${totalPals} (${Math.round(drawnCount/totalPals*100)}%)`;
    document.getElementById("progress-info").textContent = progressText;
  }

  function toggleDraw() {
    const btn = document.getElementById("draw-button");

    if (!drawing) {
      if (availableList.length === 0) {
        document.getElementById("pal-name").textContent = "æ‰€æœ‰å¸•é²å·²è¢«æŠ½å–å®Œæˆï¼";
        btn.textContent = "å…¨éƒ¨æŠ½å®Œ";
        btn.classList.add("btn-disabled");
        btn.disabled = true;
        
        // éšè—æ‰€æœ‰å›¾ç‰‡
        document.querySelectorAll('.fade-img').forEach(img => {
          img.classList.remove('active');
        });
        return;
      }

      drawing = true;
      btn.textContent = "åœæ­¢æŠ½å–";
      startRolling();

    } else {
      drawing = false;
      stopRolling();

      // åº”ç”¨æŠ½å–ç»“æœåŠ¨ç”»
      document.getElementById(`pal-image-${imgIndex + 1}`).classList.add('draw-result');
      setTimeout(() => {
        document.getElementById(`pal-image-${imgIndex + 1}`).classList.remove('draw-result');
      }, 600);

      // å°†å½“å‰å¸•é²åŠ å…¥å·²æŠ½å–å†å²
      if (currentPalName) {
        drawnHistory.add(currentPalName);
        drawnCount++; // å¢åŠ å·²æŠ½å–è®¡æ•°
        // æ›´æ–°å¯æŠ½å–åˆ—è¡¨ï¼ˆç§»é™¤å·²æŠ½å–çš„ï¼‰
        availableList = fullList.filter(pal => !drawnHistory.has(pal));
      }
      
      updateProgress(); // æ›´æ–°è¿›åº¦æ˜¾ç¤º
      btn.textContent = "å†æ¬¡æŠ½å–";
    }
  }

  function startRolling() {
    // å¼€å§‹æ—¶æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
    if (availableList.length > 0) {
      // éšæœºé€‰æ‹©ä¸€ä¸ªå¸•é²
      const randomIndex = Math.floor(Math.random() * availableList.length);
      switchImage(randomIndex);
    }
    
    let speed = 80; // åˆå§‹é€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
    let acceleration = 1.05; // åŠ é€Ÿåº¦
    let maxSpeed = 200; // æœ€å¤§å»¶è¿Ÿæ—¶é—´
    
    function roll() {
      if (!drawing) return;
      
      // éšæœºé€‰æ‹©ä¸‹ä¸€ä¸ªå¸•é²ï¼ˆåªåœ¨æœªæŠ½å–çš„å¸•é²ä¸­é€‰æ‹©ï¼‰
      currentIndex = Math.floor(Math.random() * availableList.length);
      switchImage(currentIndex);
      
      // é€æ¸å‡é€Ÿæ•ˆæœ
      speed = Math.min(speed * acceleration, maxSpeed);
      
      intervalId = setTimeout(roll, speed);
    }
    
    roll();
  }

  function stopRolling() {
    clearTimeout(intervalId);
  }

  // æ‹–æ‹½ç›¸å…³å‡½æ•°
  function dragStartHandler(event) {
    draggedElement = event.target;
    event.target.classList.add('dragging');
    
    // è·å–è¦æ‹–æ‹½çš„å¸•é²åç§°
    let palName = "";
    if (event.target.dataset.name) {
      palName = event.target.dataset.name;
    } else if (currentPalName) {
      palName = currentPalName;
    } else {
      palName = document.getElementById("pal-name").textContent;
    }
    
    event.dataTransfer.setData('text/plain', palName);
    event.dataTransfer.setData('pal-name', palName);
  }

  function dragEndHandler(event) {
    event.target.classList.remove('dragging');
    draggedElement = null;
  }

  function dragOverHandler(event) {
    event.preventDefault();
    event.currentTarget.classList.add('drag-over');
  }

  function dragLeaveHandler(event) {
    event.currentTarget.classList.remove('drag-over');
  }

  function dropHandler(event) {
    event.preventDefault();
    event.currentTarget.classList.remove('drag-over');
    
    // è·å–æ‹–æ‹½çš„æ•°æ®
    const palName = event.dataTransfer.getData('pal-name') || event.dataTransfer.getData('text/plain');
    
    if (palName && palName !== "å¼€å§‹æŠ½å–" && palName !== "å¼€å§‹æŠ½å–å¸•é²") {
      const imageUrl = getImageUrl(palName);
      
      // åˆ›å»ºæ–°çš„å›¾ç‰‡å…ƒç´ 
      const newImg = document.createElement('img');
      newImg.src = imageUrl;
      newImg.className = 'dropped-image';
      newImg.alt = palName;
      newImg.title = palName; // æ·»åŠ æç¤ºä¿¡æ¯
      newImg.draggable = true;
      newImg.dataset.name = palName;
      
      // æ·»åŠ æ‹–æ‹½äº‹ä»¶
      newImg.addEventListener('dragstart', dragStartHandler);
      newImg.addEventListener('dragend', dragEndHandler);
      
      // æ‰¾åˆ°æ”¾ç½®åŒºåŸŸå†…çš„å›¾ç‰‡å®¹å™¨
      const placedImagesContainer = event.currentTarget.querySelector('.placed-images');
      
      // æ·»åŠ æ–°å›¾ç‰‡åˆ°å®¹å™¨
      placedImagesContainer.appendChild(newImg);
      
      // å¢åŠ å·²æ”¾ç½®è®¡æ•°ï¼ˆè¿™ä¸ªä¼šåœ¨æ¸…ç†æš‚å­˜æ—¶é‡ç½®ï¼‰
      placedCount++;
      
      draggedElement = null;
    }
  }

  // æ¸…ç†æš‚å­˜ - åªæ¸…é™¤å·¦ä¾§æ”¾ç½®çš„å›¾ç‰‡ï¼Œä¿ç•™æŠ½å–è¿›åº¦
  function clearTemporary() {
    const placedImagesContainers = document.querySelectorAll('.placed-images');
    placedImagesContainers.forEach(container => {
      container.innerHTML = '';
    });
    // é‡ç½®å·¦ä¾§æ”¾ç½®è®¡æ•°ï¼Œä½†ä¿ç•™å³ä¾§æŠ½å–è¿›åº¦
    placedCount = 0;
    // è¿›åº¦æ˜¾ç¤ºä»ç„¶æ˜¾ç¤ºå·²æŠ½å–çš„æ•°é‡ï¼Œä¸éœ€è¦æ›´æ–°
  }

  // åˆå§‹åŒ–
  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("pal-name").textContent = "å¼€å§‹æŠ½å–å¸•é²";
    updateProgress();
    
    // ä¸ºå³ä¾§å›¾ç‰‡æ·»åŠ æ‹–æ‹½åŠŸèƒ½
    const fadeImages = document.querySelectorAll('.fade-img');
    fadeImages.forEach(img => {
      img.setAttribute('draggable', 'true');
      img.addEventListener('dragstart', dragStartHandler);
      img.addEventListener('dragend', dragEndHandler);
    });
  });
</script>

</body>
</html>